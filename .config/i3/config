# i3 config

# Font for window titles. Will also be used by the bar unless a different font
# is used in the bar {} block below.
font pango:monospace 8

# This font is widely installed, provides lots of unicode glyphs, right-to-left
# text rendering and scalability on retina/hidpi displays (thanks to pango).
#font pango:DejaVu Sans Mono 8

# Before i3 v4.8, we used to recommend this one as the default:
# font -misc-fixed-medium-r-normal--13-120-75-75-C-70-iso10646-1
# The font above is very space-efficient, that is, it looks good, sharp and
# clear in small sizes. However, its unicode glyph coverage is limited, the old
# X core fonts rendering does not support right-to-left and this being a bitmap
# font, it doesnâ€™t scale on retina/hidpi displays.

# Use Mouse+$mod to drag floating windows to their wanted position
floating_modifier Mod4

# no window borders
new_window pixel
hide_edge_borders smart

# colors
# class                 border  backgr. text    indicator child_border
client.focused          #4c7899 #285577 #ffffff #cc0000   #f57c00

# convenient aliases
set $mod Mod4
set $exec exec --no-startup-id
set $exec_always exec_always --no-startup-id
set $scripts_dir /home/tlegutko/.config/scripts

# monitor names
# primary
set $lower_right "DP-4"
# HDMI
set $lower_left "DP-1"
# miniDP
set $upper_right "DP-0"
# USB-C
set $upper_left "DP-6"

# nvidia same as xrandr, but ForceFullCompositionPipeline fixes screen tearing
$exec xrandr --output $lower_right --primary
$exec_always nvidia-settings --assign CurrentMetaMode="DP-4: 1920x1080 +1920+1080 { ForceFullCompositionPipeline = On }, DP-1: 1920x1080 +0+1080 { ForceFullCompositionPipeline = On }, DP-0: 1920x1080 +1920+0 { ForceFullCompositionPipeline = On }, DP-6: 1680x1050 +240+30 { ForceFullCompositionPipeline = On }"

#compton compositor to eliminate stutters when scrolling
$exec compton -cCzGb -t-3 -l-5 -r4 \
 --config /dev/null --backend xrender \
 --unredir-if-possible

# nice black wallpaper, needed because compton makes the default grey
$exec hsetroot -solid "#000000"

workspace 1 output $upper_left
workspace 2 output $upper_right
workspace 3 output $lower_left
workspace 4 output $lower_right
workspace 5 output $upper_left
workspace 6 output $upper_right
workspace 7 output $lower_left
workspace 8 output $lower_right
# workspace 9 output $lower_right 
workspace 10 output $lower_right 

# Start i3bar to display a workspace bar (plus the system information i3status
# finds out, if available)
bar {
        position top
	font pango:DejaVu Sans Mono, FontAwesome 8
	tray_output primary
	status_command i3blocks
  colors {
    binding_mode #ffa500 #285577 #ffffff 
    focused_workspace  #cc0000 #f57c00 #222222
  }
}
set $bar_refresh pkill -RTMIN+10 i3blocks
set $delayed_bar_refresh sleep 0.05 && pkill -RTMIN+10 i3blocks

# brightness
bindsym KP_Subtract $exec "xbacklight -10 && $bar_refresh"
bindsym KP_Add $exec "xbacklight +10 && $bar_refresh"
$exec xbacklight -set 30

# volume & playback cotrol
bindsym XF86AudioRaiseVolume $exec \
  "pactl set-sink-mute @DEFAULT_SINK@ false \
  && (($($scripts_dir/sound_status.sh) <= 90)) \
  && pactl set-sink-volume @DEFAULT_SINK@ +10% \
  && $bar_refresh"
bindsym XF86AudioLowerVolume $exec "pactl set-sink-volume @DEFAULT_SINK@ -10% && $bar_refresh"
bindsym XF86AudioMute $exec "pactl set-sink-mute @DEFAULT_SINK@ toggle && $bar_refresh"
bindsym XF86AudioMicMute $exec "pactl set-source-mute @DEFAULT_SOURCE@ toggle"
bindsym KP_Insert $exec "playerctl previous && $delayed_bar_refresh"
bindsym KP_Delete $exec "playerctl next && $delayed_bar_refresh"
bindsym KP_Enter $exec "playerctl play-pause && $delayed_bar_refresh"
bindsym $mod+comma  $exec "playerctl previous && $delayed_bar_refresh"
bindsym $mod+period $exec "playerctl next && $delayed_bar_refresh"
bindsym $mod+slash $exec "playerctl play-pause && $delayed_bar_refresh"

# bluetooth
bindsym KP_Divide $exec "$scripts_dir/bluetooth_off.sh && $delayed_bar_refresh"
bindsym KP_Multiply $exec "$scripts_dir/bluetooth_on.sh && $delayed_bar_refresh"

# daemons
$exec nm-applet
$exec /usr/lib/kdeconnectd
$exec redshift -l 50.094732:19.973673 -t 5500:3100
$exec $scripts_dir/focus-last.py
$exec dunst -config ~/.config/dunst/dunstrc

# app to workspace assignment
for_window [class="Spotify"] move to workspace "10:spotify"

# startup apps
$exec spotify

# double prssing workspace num goes back to previous one
workspace_auto_back_and_forth yes

popup_during_fullscreen leave_fullscreen

# touchpad
$exec xinput set-prop "SynPS/2 Synaptics TouchPad" "Device Enabled" 0

# trackpoint
$exec_always xinput set-prop "TPPS/2 IBM TrackPoint" "libinput Accel Speed" 1

# remapping keyboard.. a lot!
$exec $scripts_dir/remap-keyboard.sh

# cursor size & hiding
$exec xrdb ~/.Xresources
$exec unclutter --timeout 1
mouse_warping output

# dropdown terminals
$exec termite -t "0-dropdown"
$exec emacsclient -c -n -F "((title . \"1-dropdown\"))"
$exec emacsclient -c -n -F "((title . \"2-dropdown\"))"
$exec emacsclient -c -n -F "((title . \"3-dropdown\"))"
$exec emacsclient -c -n -F "((title . \"4-dropdown\"))"
for_window [title="0-dropdown"] floating enable 
for_window [title="0-dropdown"] move scratchpad
for_window [title="1-dropdown"] floating enable 
for_window [title="1-dropdown"] move scratchpad
for_window [title="2-dropdown"] floating enable 
for_window [title="2-dropdown"] move scratchpad
for_window [title="3-dropdown"] floating enable 
for_window [title="3-dropdown"] floating enable 
for_window [title="4-dropdown"] move scratchpad
for_window [title="4-dropdown"] move scratchpad

# screen locking and suspending
$exec xautolock -detectsleep \
-notify 30 \
-notifier "notify-send 'Sleeping time' 'Turning screen off in 30s.'" \
-time 10 -locker "xset dpms force off" \
-killtime 10 -killer "systemctl suspend"
# -corners "----" -cornersize 150

# resize wirdow (you can also use the mouse for that)
mode "resize" {
  bindsym h resize shrink width 10 px or 10 ppt
  bindsym j resize shrink height 10 px or 10 ppt
  bindsym k resize grow height 10 px or 10 ppt
  bindsym l resize grow width 10 px or 10 ppt
  # exit resize mode
  bindsym r mode "default"
  bindsym Escape mode "default"
  bindcode mod5+27 mode "default"
}

# basic bindings
bindsym $mod+Return $exec emacsclient -c -n
bindsym $mod+q kill
bindsym $mod+w $exec $scripts_dir/rename-workspace.sh
bindsym $mod+e $exec emacsclient -c -n
bindsym $mod+r mode "resize"
bindsym $mod+y mode "resize"
bindsym $mod+t $exec termite -d `xcwd`
bindsym $mod+d $exec i3-dmenu-desktop --dmenu="dmenu -b -i"
bindsym $mod+f fullscreen toggle
bindsym $mod+g $exec google-chrome-stable
bindsym $mod+v split h
bindsym $mod+b split v
bindsym $mod+c $exec ~/.sync.sh && i3-msg reload
bindsym Control+$mod+r $exec ~/.sync.sh && i3-msg restart
bindsym Control+$mod+e exec "i3-nagbar -t warning -m 'You pressed the exit shortcut. Do you really want to exit i3? This will end your X session.' -b 'Yes, exit i3' 'i3-msg exit'"
bindsym $mod+s $exec systemctl suspend
bindsym $mod+h focus left
bindsym $mod+j focus down
bindsym $mod+k focus up
bindsym $mod+l focus right
bindsym Control+$mod+h move left
bindsym Control+$mod+j move down
bindsym Control+$mod+k move up
bindsym Control+$mod+l move right
bindsym $mod+a focus parent
bindsym $mod+z focus child
bindsym $mod+o $exec okular
# screenshot of selection
bindsym --release $mod+p $exec scrot -s -e 'xclip -selection clipboard -t image/png $f && mv $f ~/Pictures/'
# presentation mirroring mode
bindsym Control+$mod+p $exec xrandr \
     --output $lower_right --auto --primary \
     --output $lower_left --auto --same-as $lower_right \
     --output $upper_right --auto --same-as $lower_right \
     --output $upper_left --auto --same-as $lower_right
bindsym $mod+1 workspace number 1
bindsym $mod+2 workspace number 2
bindsym $mod+3 workspace number 3
bindsym $mod+4 workspace number 4
bindsym $mod+5 workspace number 5
bindsym $mod+6 workspace number 6
bindsym $mod+7 workspace number 7
bindsym $mod+8 workspace number 8
bindsym $mod+9 workspace number 9
bindsym $mod+0 workspace number 10
bindsym Control+$mod+1 move container to workspace number 1
bindsym Control+$mod+2 move container to workspace number 2
bindsym Control+$mod+3 move container to workspace number 3
bindsym Control+$mod+4 move container to workspace number 4
bindsym Control+$mod+5 move container to workspace number 5
bindsym Control+$mod+6 move container to workspace number 6
bindsym Control+$mod+7 move container to workspace number 7
bindsym Control+$mod+8 move container to workspace number 8
bindsym Control+$mod+9 move container to workspace number 9
bindsym Control+$mod+0 move container to workspace number 10
bindsym $mod+m $exec $scripts_dir/toggle_trackpoint.sh
bindsym Control+$mod+m $exec $scripts_dir/toggle_touchpad.sh
bindsym $mod+bracketleft $exec $scripts_dir/add-citation-to-masters-thesis.sh
bindsym $mod+grave $exec $scripts_dir/toggle_dropdown_terminal.sh 0
bindsym Control+$mod+grave $exec termite -t "0-dropdown"
bindsym $mod+F1 $exec $scripts_dir/toggle_dropdown_terminal.sh 1
bindsym Control+$mod+F1 $exec emacsclient -c -n -F '((title . \"1-dropdown\"))'
bindsym $mod+F2 $exec $scripts_dir/toggle_dropdown_terminal.sh 2
bindsym Control+$mod+F2 $exec emacsclient -c -n -F '((title . \"2-dropdown\"))'
bindsym $mod+F3 $exec $scripts_dir/toggle_dropdown_terminal.sh 3
bindsym Control+$mod+F3 $exec emacsclient -c -n -F '((title . \"3-dropdown\"))'
bindsym $mod+F4 $exec $scripts_dir/toggle_dropdown_terminal.sh 4
bindsym Control+$mod+F4 $exec emacsclient -c -n -F '((title . \"4-dropdown\"))'
bindsym $mod+KP_Left move workspace to output left
bindsym $mod+KP_Down move workspace to output down
bindsym $mod+KP_Up move workspace to output up
bindsym $mod+KP_Right move workspace to output right